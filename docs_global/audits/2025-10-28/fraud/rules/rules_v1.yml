# Baseline fraud ruleset â€” v1.0.0 (2025-10-24)
# Notes:
# - Conditions are expressed as simple expressions over the transaction (tx) and lightweight context (ctx).
# - Your scoring code can map these into actual checks; unknown keys can be ignored safely.

meta:
  version: "1.0.0"
  effective_date: "2025-10-24"
  description: "Baseline production ruleset paired with Stage 3 model and Stage 4 API."

defaults:
  action: "review"        # default action when a rule hits
  score_delta: 0.20       # default score bump if not overridden
  severity: "medium"

rules:

  - id: R001_HIGH_AMOUNT_NEW_ACCOUNT
    enabled: true
    description: "High amount on a young account."
    when:
      all:
        - "tx.amount >= 10000"
        - "tx.account_age_days < 30"
    effect:
      action: "review"
      score_delta: 0.35
      severity: "high"
      reasons: ["high_amount_new_account"]

  - id: R002_VELOCITY_SPIKE
    enabled: true
    description: "Short-window transaction spike vs recent personal baseline."
    params:
      window_minutes: 30
      baseline_days: 14
      multiplier: 3.5     # per 2025-10-12 adjustment
    # Implementation detail: backend sets ctx.velocity_spike=true when condition is met.
    when:
      any:
        - "ctx.velocity_spike == true"
    effect:
      action: "review"
      score_delta: 0.25
      severity: "medium"
      reasons: ["velocity_spike"]

  - id: R003_CROSS_BORDER_ODD_HOURS
    enabled: true
    description: "Cross-border transactions during riskier night hours."
    params:
      odd_hours: [0, 1, 2, 3, 4, 5, 23]
    when:
      all:
        - "tx.country != ctx.home_country"   # set ctx.home_country from KYC/profile
        - "tx.hour_of_day in params.odd_hours"
    effect:
      action: "review"
      score_delta: 0.20
      severity: "medium"
      reasons: ["cross_border_odd_hours"]

  - id: R004_HIGH_AMOUNT_NEW_DEVICE
    enabled: true
    description: "Very high amount on a first-seen device for this account."
    added_in: "2025-10-18"
    params:
      threshold_amount: 7500
    # Implementation detail: backend sets ctx.device_is_new=true when device_id not seen for account.
    when:
      all:
        - "tx.amount >= params.threshold_amount"
        - "ctx.device_is_new == true"
        - "tx.account_age_days < 365"        # reduce false positives on long-tenure users
    effect:
      action: "review"
      score_delta: 0.30
      severity: "high"
      reasons: ["high_amount_new_device"]
